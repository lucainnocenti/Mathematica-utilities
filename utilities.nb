(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     75188,       1955]
NotebookOptionsPosition[     72144,       1851]
NotebookOutlinePosition[     72554,       1868]
CellTagsIndexPosition[     72511,       1865]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["BeginPackage", "Section",
 CellChangeTimes->{{3.658124815614797*^9, 3.65812481676852*^9}}],

Cell[BoxData[
 RowBox[{"BeginPackage", "[", "\"\<utilities`\>\"", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.6803302331856527`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Usages", "Section",
 CellChangeTimes->{{3.6581248265585985`*^9, 3.658124827112677*^9}}],

Cell[TextData[{
 StyleBox["Only the functions which usage is specified here will be included \
when ",
  FontSize->16,
  FontColor->RGBColor[0.5, 0, 0.5]],
 StyleBox["Need",
  FontSize->16,
  FontSlant->"Italic",
  FontColor->RGBColor[0.5, 0, 0.5]],
 StyleBox["ing the package",
  FontSize->16,
  FontColor->RGBColor[0.5, 0, 0.5]]
}], "Text",
 CellChangeTimes->{{3.6618429644491234`*^9, 3.661842975686395*^9}, {
  3.661843069259633*^9, 3.6618430696637526`*^9}, {3.661843382538559*^9, 
  3.661843535650234*^9}, {3.6618461796841497`*^9, 3.661846203657056*^9}},
 FontWeight->"Bold",
 FontColor->RGBColor[0, 0, 1]],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"MONITORING", " ", "UTILITIES"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"progressBar", "::", "usage"}], "=", 
     "\"\<progressBar[n] displays a progress bar with progress n%.\>\""}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"conditionalMonitor", "::", "usage"}], "=", 
     "\"\<conditionalMonitor[test,i] gives a function which monitors the \
function i in its argument if test evaluated to True.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"CLEAR", " ", "MEMOIZED", " ", "VALUES", " ", "UTILITIES"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearDownValues", "::", "usage"}], "=", 
    "\"\<ClearDownValues[p] removes the downvalues given in input as a \
pattern.\>\""}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ClearCache", "::", "usage"}], "=", 
    "\"\<ClearCache[f] clears all memoized values from f.\>\""}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"PLOTTING", " ", "UTILITIES"}], " ", "*)"}], 
   "\[IndentingNewLine]", "simpleLegend", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"legendMaker", "::", "usage"}], "=", 
     "\"\<Create a Graphics object with legends given by the list passed as \
the first argument. The options specify any non-deafult line styles (using \
PlotStyle -> {...}) or plot markers (using PlotMarkers -> {...}). For more \
options, inspect Options[legendMaker]\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"extractStyles", "::", "usage"}], "=", 
     "\"\<returns a tuple {\\\"all line style directives\\\", \\\"all plot \
markers\\\"} found in the plot, in the order they are drawn. The two sublists \
need not have the same length if some lines don't use markers \>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"autoLegend", "::", "usage"}], "=", 
     "\"\<Simplified legending for the plot passed as first argument, with \
legends given as second argument. Use the option Alignment -> {horizontal, \
vertical} to place the legend in the PlotRegion in scaled coordinates. For \
other options, see Options[legendMaker] which are used by autoLegend.\>\""}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6581249512005963`*^9, 3.6581249833944025`*^9}, {
   3.659013266402837*^9, 3.65901330371609*^9}, 3.6590133462349725`*^9, {
   3.661496967468598*^9, 3.661497046270397*^9}, {3.661500396494734*^9, 
   3.661500396936467*^9}, {3.661613565889752*^9, 3.661613628246586*^9}, {
   3.661846243609378*^9, 3.661846268698996*^9}, {3.6803299219332795`*^9, 
   3.6803299257692814`*^9}, {3.680330073558081*^9, 3.6803300748530645`*^9}}],

Cell["Miscellaneous utilities", "Text",
 CellChangeTimes->{{3.6618429644491234`*^9, 3.661842975686395*^9}, {
  3.661843069259633*^9, 3.6618430696637526`*^9}, {3.661843382538559*^9, 
  3.661843535650234*^9}, {3.6618461796841497`*^9, 3.661846203657056*^9}, {
  3.6618463181246233`*^9, 3.6618463251335087`*^9}, {3.665075301515749*^9, 
  3.66507530416061*^9}},
 FontWeight->"Bold",
 FontColor->RGBColor[0, 0, 1]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"exportHere", "::", "usage"}], "=", 
  "\"\<exportHere[fileName,object] saves object in the current directory with \
the name fileName.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"absSquared", "::", "usage"}], "=", 
  "\"\<absSquared[z] returns the square of the absolute value of z.\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"traceView2", "::", "usage"}], "=", 
  "\"\<traceView2[expr] returns a formatted view of the TraceScan of the \
expression.\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"seeOptions", "::", "usage"}], "=", 
  "\"\<seeOptions[function] returns the list of options defined for function, \
without the clumsy whatever`private`stuff notation.\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"factorInteger", "::", "usage"}], "=", 
  "\"\<factorInteger[n] returns the prime integer factorization of n, nicely \
formatted.\>\""}], "\[IndentingNewLine]", "dynamicPlot", \
"\[IndentingNewLine]", "dynamicPlot2", "\[IndentingNewLine]", "texStyles"}], \
"Input",
 InitializationCell->True,
 CellChangeTimes->{{3.66184632954582*^9, 3.661846334427473*^9}, {
   3.661846875118466*^9, 3.6618469985361214`*^9}, {3.6618484075059104`*^9, 
   3.661848442633364*^9}, {3.6683338985874662`*^9, 3.668333926822194*^9}, {
   3.6768957433039703`*^9, 3.6768957451033564`*^9}, {3.6768960399979954`*^9, 
   3.676896042045426*^9}, 3.6803299961212044`*^9, {3.6803301267752237`*^9, 
   3.6803301285922117`*^9}}],

Cell[CellGroupData[{

Cell["Dynamically highlighting", "Subsection",
 CellChangeTimes->{{3.680330170234161*^9, 3.6803301748851676`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"dynamicallyHighlight", "::", "usage"}], "=", 
   "\"\<DynamicallyHighlight[tableToHighlight,equivalenceTest] prints a \
dynamic version of tableToHighlight where hovering with the mouse on the \
element elem1 highlights all elements elem2 of tableToHighlight such that \
equivalenceTest[elem1,elem2] is True.\>\""}], ";"}]], "Input",
 CellChangeTimes->{
  3.680330177322951*^9, {3.6803302079501257`*^9, 3.6803302086651278`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["3D Plotting utilities", "Subsection",
 CellChangeTimes->{{3.680330081470067*^9, 3.6803300849381037`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"3", "D", " ", "Plotting", " ", "utilities"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"barChart3D", "::", "usage"}], "=", 
   "\"\<barChart3D[matrix_] draws a 3D plot chart, using the values of the \
input matrix as heights of the cuboids.\>\""}]}]], "Input"],

Cell[TextData[{
 "Efficient 3D circle arc function ",
 StyleBox["splineCircle",
  FontSlant->"Italic"],
 ", by Sjoerd (see http://mathematica.stackexchange.com/a/10958/27539)"
}], "Text",
 CellChangeTimes->{{3.6618429644491234`*^9, 3.661842975686395*^9}, {
  3.661843069259633*^9, 3.6618430696637526`*^9}, {3.661843382538559*^9, 
  3.661843535650234*^9}, {3.6618461796841497`*^9, 3.661846203657056*^9}, {
  3.6618463181246233`*^9, 3.6618463251335087`*^9}, {3.665075301515749*^9, 
  3.665075343838553*^9}, {3.665075389519806*^9, 3.665075392459381*^9}, {
  3.665075502180645*^9, 3.6650755032981234`*^9}, {3.680330094302075*^9, 
  3.6803300944111013`*^9}},
 FontWeight->"Bold",
 FontColor->RGBColor[0, 0, 1]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"splineCircle", "::", "usage"}], "=", 
   "\"\<splineCircle[c,r,angles] produces a BSplineCurve object representing \
an arc on the x-y plane, centered at the (2- or 3-dimensional) point m, with \
radius r, covering the angles specified in angles\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.665075774276293*^9, 3.665075871891176*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Private Context", "Section",
 CellChangeTimes->{{3.6581248375940804`*^9, 3.6581248547446995`*^9}}],

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"factorInteger", "[", "n_Integer", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"FactorInteger", "[", "n", "]"}], "//", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{"Superscript", "[", 
       RowBox[{
        RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        ",", 
        RowBox[{"#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
        "]"}], "&"}], "]"}]}], "//", 
   RowBox[{
    RowBox[{"Row", "[", 
     RowBox[{"#", ",", "\"\<\[Cross]\>\""}], "]"}], "&"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6683339413488207`*^9, 3.6683339516937776`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"progressBar", "[", 
     RowBox[{"progressIndex_", "?", "NumericQ"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"Row", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ProgressIndicator", "[", 
           RowBox[{"#", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "100"}], "}"}]}], "]"}], ",", "#"}], "}"}], 
        ",", "\"\< \>\""}], "]"}], "&"}], "@", "progressIndex"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Attributes", "[", "conditionalMonitor", "]"}], "=", 
   RowBox[{"{", "HoldRest", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"conditionalMonitor", "[", 
    RowBox[{"test_", ",", "monitoredVariable_"}], "]"}], ":=", 
   RowBox[{"Function", "[", "\[IndentingNewLine]", 
    RowBox[{"code", ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "@", "test"}], ",", 
       RowBox[{"Monitor", "[", 
        RowBox[{"code", ",", 
         RowBox[{"progressBar", "[", "monitoredVariable", "]"}]}], "]"}], ",",
        "code"}], "]"}], ",", "\[IndentingNewLine]", "HoldAll"}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ClearDownValues", ",", "HoldAllComplete"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ClearDownValues", "[", 
    RowBox[{"p", ":", 
     RowBox[{"f_", "[", "___", "]"}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DownValues", "[", "f", "]"}], "=", 
    RowBox[{"DeleteCases", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DownValues", "[", 
       RowBox[{"f", ",", 
        RowBox[{"Sort", "\[Rule]", "False"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"HoldPattern", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Verbatim", "[", "HoldPattern", "]"}], "[", "p", "]"}], 
        "\[RuleDelayed]", "_"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearCache", "[", "f_", "]"}], ":=", 
  RowBox[{
   RowBox[{"DownValues", "[", "f", "]"}], "=", 
   RowBox[{"DeleteCases", "[", 
    RowBox[{
     RowBox[{"DownValues", "[", "f", "]"}], ",", 
     RowBox[{"_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{
          RowBox[{"First", "[", "#", "]"}], ",", "Pattern"}], "]"}], "&"}], 
       ")"}]}]}], "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.649964352702235*^9, 3.649964432802817*^9}, {
   3.649964929372219*^9, 3.6499649698385334`*^9}, {3.6499658546570864`*^9, 
   3.6499658955359945`*^9}, {3.650372282562534*^9, 3.6503722844969373`*^9}, 
   3.650372454761037*^9, {3.650382542846671*^9, 3.650382749263406*^9}, {
   3.650387205999337*^9, 3.6503872122246933`*^9}, {3.650390170875663*^9, 
   3.650390195829327*^9}, 3.656173447788499*^9, {3.6577473537319674`*^9, 
   3.657747400913546*^9}, {3.6577825974260964`*^9, 3.657782709919218*^9}, {
   3.6577836166399713`*^9, 3.6577836742054863`*^9}, {3.6578633594013443`*^9, 
   3.657863456738683*^9}, {3.6578635671153183`*^9, 3.657863567542082*^9}, {
   3.657863597845614*^9, 3.6578636372896357`*^9}, {3.657863702004014*^9, 
   3.6578637022350984`*^9}, {3.657863919410515*^9, 3.65786393489592*^9}, {
   3.6578641420358953`*^9, 3.657864142633922*^9}, {3.657864191249815*^9, 
   3.657864196430882*^9}, {3.657894952912072*^9, 3.657895023728461*^9}, {
   3.6578950849357033`*^9, 3.657895088270796*^9}, {3.657895260109092*^9, 
   3.657895276241164*^9}, 3.6578955842874255`*^9, {3.657895656338204*^9, 
   3.657895735145264*^9}, {3.6581248194179225`*^9, 3.6581248735698423`*^9}, {
   3.6581249124827285`*^9, 3.6581249130616026`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"exportHere", "[", 
   RowBox[{"name_", ",", "obj_"}], "]"}], ":=", 
  RowBox[{"Export", "[", 
   RowBox[{
    RowBox[{"FileNameJoin", "@", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"NotebookDirectory", "[", "]"}], ",", "name"}], "}"}]}], ",", 
    "obj"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6602022154604177`*^9, 3.660202217327279*^9}}],

Cell[BoxData[
 RowBox[{"texStyles", "=", 
  RowBox[{"<|", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\"\<plain\>\"", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Black", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"FontFamily", "\[Rule]", "\"\<LM Roman 12\>\""}], ",", 
         RowBox[{"FontSize", "\[Rule]", "24"}], ",", 
         RowBox[{"FontWeight", "\[Rule]", "Plain"}], ",", 
         RowBox[{"FontSlant", "\[Rule]", "Plain"}]}], "}"}]}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"\"\<writing\>\"", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Black", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"FontFamily", "\[Rule]", "\"\<CMU Serif\>\""}], ",", 
         RowBox[{"FontSize", "\[Rule]", "20"}], ",", 
         RowBox[{"FontWeight", "\[Rule]", "Plain"}], ",", 
         RowBox[{"FontSlant", "\[Rule]", "Plain"}]}], "}"}]}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"\"\<title\>\"", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Black", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"FontFamily", "\[Rule]", "\"\<CMU Serif\>\""}], ",", 
         RowBox[{"FontSize", "\[Rule]", "24"}], ",", 
         RowBox[{"FontWeight", "\[Rule]", "Plain"}], ",", 
         RowBox[{"FontSlant", "\[Rule]", "Plain"}]}], "}"}]}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"\"\<labels\>\"", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Black", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"FontFamily", "\[Rule]", "\"\<LMMathItalic10\>\""}], ",", 
         RowBox[{"FontSize", "\[Rule]", "24"}], ",", 
         RowBox[{"FontWeight", "\[Rule]", "Plain"}], ",", 
         RowBox[{"FontSlant", "\[Rule]", "Plain"}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "|>"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.660390942728385*^9, 3.660390948552873*^9}, {
  3.6603910140138865`*^9, 3.660391050305766*^9}, {3.6803300138532457`*^9, 
  3.6803300534390717`*^9}, {3.6803361917182164`*^9, 3.6803361958722205`*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"seeOptions", "[", "function_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Thread", "@", 
      RowBox[{"Rule", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "//", 
         RowBox[{"Map", "[", "SymbolName", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"#", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "&"}], "@", 
    RowBox[{"Options", "[", "function", "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6616138428317637`*^9, 3.66161385294409*^9}, {
   3.6618484637549405`*^9, 3.661848498011427*^9}, 3.680330002346258*^9}],

Cell[CellGroupData[{

Cell["Legending utilities", "Subsection",
 CellChangeTimes->{{3.6581249030337896`*^9, 3.658124906822241*^9}}],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "simpleLegend", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "simpleLegend", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"fontSize", "\[Rule]", "11"}], ",", 
     RowBox[{"imageSize", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"20", ",", "10"}], "}"}]}], ",", 
     RowBox[{"insetpts", "\[Rule]", "10"}], ",", 
     RowBox[{"lineThickness", "\[Rule]", "0.001"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"simpleLegend", "[", 
    RowBox[{"legendItems__", ",", "pos_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"legendLine", ",", "offset", ",", "legend"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"offset", "=", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"s", ",", "o"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"s", "=", 
           RowBox[{"pos", "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Left", "\[Rule]", "0"}], ",", 
              RowBox[{"Right", "\[Rule]", "1"}], ",", 
              RowBox[{"Bottom", "\[Rule]", "0"}], ",", 
              RowBox[{"Top", "\[Rule]", "1"}]}], "}"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"o", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"OptionValue", "@", "insetpts"}], " ", "pos"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Left", "\[Rule]", "1"}], ",", 
              RowBox[{"Right", "\[Rule]", 
               RowBox[{"-", "1"}]}], ",", 
              RowBox[{"Bottom", "\[Rule]", "1"}], ",", 
              RowBox[{"Top", "\[Rule]", 
               RowBox[{"-", "1"}]}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Offset", "[", 
           RowBox[{"o", ",", 
            RowBox[{"Scaled", "[", "s", "]"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"legendLine", "[", 
        RowBox[{"{", 
         RowBox[{"lbl_", ",", "lineStyle_"}], "}"}], "]"}], ":=", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"lineStyle", ",", 
             RowBox[{"Thickness", "@", "0.02"}], ",", 
             RowBox[{"Line", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "0.5"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0.5"}], "}"}]}], "}"}], "]"}]}], "}"}], 
           ",", 
           RowBox[{"ImageSize", "\[Rule]", 
            RowBox[{"OptionValue", "@", "imageSize"}]}], ",", 
           RowBox[{"AspectRatio", "\[Rule]", "0.5"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Style", "[", 
          RowBox[{"lbl", ",", 
           RowBox[{"FontFamily", "\[Rule]", "\"\<Tahoma\>\""}], ",", 
           RowBox[{"FontSize", "\[Rule]", 
            RowBox[{"OptionValue", "@", "fontSize"}]}], ",", 
           RowBox[{"TextAlignment", "\[Rule]", "Left"}], ",", 
           RowBox[{"LineBreakWithin", "\[Rule]", "False"}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"legend", "=", 
       RowBox[{"GraphicsGrid", "[", 
        RowBox[{
         RowBox[{"legendLine", "/@", "legendItems"}], ",", 
         RowBox[{"Alignment", "\[Rule]", "Left"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Graphics", "@", 
       RowBox[{"Inset", "[", 
        RowBox[{
         RowBox[{"Panel", "[", "legend", "]"}], ",", "offset", ",", "pos"}], 
        "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "legendMaker", "]"}], "=", 
   RowBox[{"Join", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"Options", "[", "Framed", "]"}], ",", 
       RowBox[{"Except", "[", 
        RowBox[{"{", 
         RowBox[{
         "ImageSize", ",", "FrameStyle", ",", "Background", ",", 
          "RoundingRadius", ",", "ImageMargins"}], "}"}], "]"}]}], "]"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FrameStyle", "\[Rule]", "None"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Background", "\[Rule]", 
        RowBox[{"Directive", "[", 
         RowBox[{
          RowBox[{"Opacity", "[", ".7", "]"}], ",", "LightGray"}], "]"}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"RoundingRadius", "\[Rule]", "10"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ImageMargins", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{"PlotStyle", "\[Rule]", "Automatic"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"PlotMarkers", "\[Rule]", "None"}], ",", "\[IndentingNewLine]", 
       RowBox[{"\"\<LegendLineWidth\>\"", "\[Rule]", "35"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<LegendLineAspectRatio\>\"", "\[Rule]", ".3"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<LegendMarkerSize\>\"", "\[Rule]", "8"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<LegendGridOptions\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Alignment", "\[Rule]", "Left"}], ",", 
          RowBox[{"Spacings", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{".4", ",", ".1"}], "}"}]}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"legendMaker", "[", 
     RowBox[{"textLabels_", ",", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"f", ",", "lineDirectives", ",", "markerSymbols", ",", 
        RowBox[{"n", "=", 
         RowBox[{"Length", "[", "textLabels", "]"}]}], ",", "x"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"lineDirectives", "=", 
        RowBox[{
         RowBox[{"(", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"PlotStyle", "/.", 
             RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
           RowBox[{
            RowBox[{"PlotStyle", "|", "Automatic"}], "\[RuleDelayed]", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{"ColorData", "[", "1", "]"}], ",", 
              RowBox[{"Range", "[", "n", "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", ")"}], "/.", 
         RowBox[{"None", "\[Rule]", 
          RowBox[{"{", "None", "}"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"markerSymbols", "=", 
        RowBox[{
         RowBox[{"Replace", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"PlotMarkers", "/.", 
                RowBox[{"{", "opts", "}"}]}], ")"}], "/.", 
              RowBox[{"Automatic", "\[RuleDelayed]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Drop", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Normal", "[", 
                    RowBox[{
                    RowBox[{"ListPlot", "[", 
                    RowBox[{
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"Range", "[", "3", "]"}], "}"}], "]"}], ",", 
                    RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}]}], "]"}], 
                    "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"-", "1"}]}], "]"}], "/.", 
                  RowBox[{
                   RowBox[{"Inset", "[", 
                    RowBox[{"x_", ",", "i__"}], "]"}], "\[RuleDelayed]", 
                   "x"}]}], ")"}], "\[LeftDoubleBracket]", 
                RowBox[{"All", ",", 
                 RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}]}], 
             "\[IndentingNewLine]", ")"}], "/.", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Graphics", "[", "gr__", "]"}], ",", "sc_"}], "}"}], 
             "\[RuleDelayed]", 
             RowBox[{"Graphics", "[", 
              RowBox[{"gr", ",", 
               RowBox[{"ImageSize", "\[Rule]", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"\"\<LegendMarkerSize\>\"", "/.", 
                    RowBox[{"{", "opts", "}"}]}], "/.", 
                   RowBox[{"Options", "[", 
                    RowBox[{"legendMaker", ",", "\"\<LegendMarkerSize\>\""}], 
                    "]"}]}], "/.", 
                  RowBox[{"{", 
                   RowBox[{"\"\<LegendMarkerSize\>\"", "\[Rule]", "8"}], 
                   "}"}]}], ")"}]}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"PlotMarkers", "|", "None"}], "\[RuleDelayed]", 
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"\"\<\>\"", ",", 
                 RowBox[{"Opacity", "[", "0", "]"}]}], "]"}], "&"}], ",", 
              "textLabels"}], "]"}]}]}], "]"}], "/.", 
         RowBox[{
          RowBox[{"None", "|", 
           RowBox[{"{", "}"}]}], "\[Rule]", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<\>\"", ",", 
            RowBox[{"Opacity", "[", "0", "]"}]}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lineDirectives", "=", 
        RowBox[{"PadRight", "[", 
         RowBox[{"lineDirectives", ",", "n", ",", "lineDirectives"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"markerSymbols", "=", 
        RowBox[{"PadRight", "[", 
         RowBox[{"markerSymbols", ",", "n", ",", "markerSymbols"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"f", "=", 
        RowBox[{"Grid", "[", 
         RowBox[{
          RowBox[{"MapThread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Graphics", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#1", "/.", 
                    RowBox[{"None", "\[Rule]", 
                    RowBox[{"{", "}"}]}]}], ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#1", "===", 
                    RowBox[{"{", "None", "}"}]}], "||", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"PlotStyle", "/.", 
                    RowBox[{"{", "opts", "}"}]}], ")"}], "===", "None"}]}], 
                    ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"Line", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", ".1"}], ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{".1", ",", "0"}], "}"}]}], "}"}], "]"}]}], "]"}], 
                   ",", 
                   RowBox[{"Inset", "[", 
                    RowBox[{"#2", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", 
                    RowBox[{"Background", "\[Rule]", "None"}]}], "]"}]}], 
                  "}"}], ",", 
                 RowBox[{"AspectRatio", "\[Rule]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"\"\<LegendLineAspectRatio\>\"", "/.", 
                    RowBox[{"{", "opts", "}"}]}], "/.", 
                    RowBox[{"Options", "[", 
                    RowBox[{
                    "legendMaker", ",", "\"\<LegendLineAspectRatio\>\""}], 
                    "]"}]}], "/.", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<LegendLineAspectRatio\>\"", "\[Rule]", ".2"}], 
                    "}"}]}], ")"}]}], ",", 
                 RowBox[{"ImageSize", "\[Rule]", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"\"\<LegendLineWidth\>\"", "/.", 
                    RowBox[{"{", "opts", "}"}]}], "/.", 
                    RowBox[{"Options", "[", 
                    RowBox[{"legendMaker", ",", "\"\<LegendLineWidth\>\""}], 
                    "]"}]}], "/.", 
                    RowBox[{"{", 
                    RowBox[{"\"\<LegendLineWidth\>\"", "\[Rule]", "35"}], 
                    "}"}]}], ")"}]}], ",", 
                 RowBox[{"ImagePadding", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}]}], "]"}], ",", 
               RowBox[{"Text", "[", 
                RowBox[{"#3", ",", 
                 RowBox[{"FormatType", "\[Rule]", "TraditionalForm"}]}], 
                "]"}]}], "}"}], "&"}], ",", 
            RowBox[{"{", 
             RowBox[{
             "lineDirectives", ",", "markerSymbols", ",", "textLabels"}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"Sequence", "@", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"\"\<LegendGridOptions\>\"", "/.", 
                RowBox[{"{", "opts", "}"}]}], "/.", 
               RowBox[{"Options", "[", 
                RowBox[{"legendMaker", ",", "\"\<LegendGridOptions\>\""}], 
                "]"}]}], "/.", 
              RowBox[{"{", 
               RowBox[{"\"\<LegendGridOptions\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Alignment", "\[Rule]", "Left"}], ",", 
                  RowBox[{"Spacings", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{".4", ",", ".1"}], "}"}]}]}], "}"}]}], "}"}]}], 
             ")"}], "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Framed", "[", 
        RowBox[{"f", ",", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Sequence", "[", 
             RowBox[{"opts", ",", 
              RowBox[{"Options", "[", "legendMaker", "]"}]}], "]"}], "}"}], 
           ",", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"Options", "[", "Framed", "]"}], ",", 
             RowBox[{"Except", "[", "ImageSize", "]"}]}], "]"}]}], "]"}]}], 
        "]"}]}]}], "]"}]}], ";"}], "\n", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"extractStyles", "[", "plot_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lines", ",", "markers", ",", "points", ",", 
       RowBox[{"extract", "=", 
        RowBox[{"First", "[", 
         RowBox[{"Normal", "[", "plot", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"In", " ", "a", " ", "plot"}], ",", 
       RowBox[{
       "the", " ", "list", " ", "of", " ", "lines", " ", "contains", " ", 
        "no", " ", "insets"}], ",", 
       RowBox[{
       "so", " ", "I", " ", "use", " ", "this", " ", "to", " ", "find", " ", 
        RowBox[{"it", ":"}]}]}], "*)"}], 
     RowBox[{
      RowBox[{"lines", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "plot", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"___", ",", "_Line", ",", "___"}], "}"}], ",", 
           "Infinity"}], "]"}], ",", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"#1", ",", "Inset"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"points", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"Normal", "[", "plot", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"___", ",", "_Point", ",", "___"}], "}"}], ",", 
           "Infinity"}], "]"}], ",", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"#1", ",", "Inset"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Most", " ", "plot", " ", "markers", " ", "are", " ", "inside", " ", 
         "Inset"}], ",", 
        RowBox[{
        "except", " ", "for", " ", "Point", " ", "in", " ", "list", " ", 
         RowBox[{"plots", ":"}]}]}], "*)"}], 
      RowBox[{"markers", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"extract", ",", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"FreeQ", "[", 
            RowBox[{"#1", ",", "Inset"}], "]"}]}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "The", " ", "function", " ", "returns", " ", "a", " ", "list", " ", 
        "of", " ", 
        RowBox[{"lists", ":"}]}], "*)"}], 
      RowBox[{"{", 
       RowBox[{"(*", 
        RowBox[{
        "The", " ", "first", " ", "return", " ", "value", " ", "is", " ", 
         "the", " ", "list", " ", "of", " ", "line", " ", "plot", " ", 
         RowBox[{"styles", ":"}]}], "*)"}], 
       RowBox[{
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{"lines", ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"c__", ",", 
               RowBox[{"Line", "[", "__", "]"}], ",", "___"}], "}"}], 
             "\[RuleDelayed]", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Directive", "@@", 
               RowBox[{"Cases", "[", 
                RowBox[{
                 RowBox[{"{", "c", "}"}], ",", 
                 RowBox[{"Except", "[", "_Line", "]"}]}], "]"}]}], "]"}]}], 
            ",", "Infinity"}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", "}"}], "\[Rule]", "None"}]}], "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{"Second", " ", "return", " ", 
          RowBox[{"value", ":", 
           RowBox[{"marker", " ", "symbols"}]}]}], "*)"}], 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Cases", "[", 
             RowBox[{"markers", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"c__", ",", 
                 RowBox[{"Inset", "[", 
                  RowBox[{"s_", ",", "pos_", ",", "d___"}], "]"}], ",", 
                 "e___"}], "}"}], "\[RuleDelayed]", 
               RowBox[{"If", "[", 
                RowBox[{"(*", 
                 RowBox[{
                 "markers", " ", "\"\<s\>\"", " ", "can", " ", "be", " ", 
                  "strings", " ", "or", " ", "graphics"}], "*)"}], 
                RowBox[{
                 RowBox[{
                  RowBox[{"Head", "[", "s", "]"}], "===", "Graphics"}], ",", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{
                   "Append", " ", "scale", " ", "factor", " ", "in", " ", 
                    "case", " ", 
                    RowBox[{"it", "'"}], "s", " ", "needed", " ", "later"}], 
                   ";", "\[IndentingNewLine]", 
                   RowBox[{"default", " ", "0.01"}]}], "*)"}], 
                 RowBox[{"{", 
                  RowBox[{"s", ",", 
                   RowBox[{
                    RowBox[{"Last", "[", 
                    RowBox[{"{", 
                    RowBox[{".01", ",", "d"}], "}"}], "]"}], "/.", 
                    RowBox[{
                    RowBox[{"Scaled", "[", "f_", "]"}], "\[RuleDelayed]", 
                    RowBox[{"First", "[", "f", "]"}]}]}]}], "}"}], ",", 
                 RowBox[{"If", "[", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"For", " ", "strings"}], ",", 
                    RowBox[{
                    "add", " ", "line", " ", "color", " ", "if", " ", "no", 
                    " ", "color", " ", "specified", " ", "via", " ", "text", 
                    " ", 
                    RowBox[{"styles", ":"}]}]}], "*)"}], 
                  RowBox[{
                   RowBox[{"FreeQ", "[", 
                    RowBox[{"s", ",", 
                    RowBox[{
                    "CMYKColor", "|", "RGBColor", "|", "GrayLevel", "|", 
                    "Hue"}]}], "]"}], ",", 
                   RowBox[{"Style", "[", 
                    RowBox[{"s", ",", "c"}], "]"}], ",", "s"}], "]"}]}], 
                "]"}]}], ",", "Infinity"}], "]"}], ",", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Filter", " ", "out", " ", "Pointsize"}], "-", 
              RowBox[{"legends", " ", 
               RowBox[{"don", "'"}], "t", " ", "need", " ", 
               RowBox[{"it", ":"}]}]}], "*)"}], 
            RowBox[{"Cases", "[", 
             RowBox[{"points", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"c___", ",", 
                 RowBox[{"Point", "[", "pt__", "]"}], ",", "___"}], "}"}], 
               "\[RuleDelayed]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Graphics", "[", 
                   RowBox[{"{", 
                    RowBox[{"c", ",", 
                    RowBox[{"Point", "[", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], "]"}]}], "}"}], "]"}], "/.", 
                  RowBox[{
                   RowBox[{"PointSize", "[", "_", "]"}], "\[RuleDelayed]", 
                   RowBox[{"PointSize", "[", "1", "]"}]}]}], ",", ".01"}], 
                "}"}]}], ",", "Infinity"}], "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"{", "}"}], "\[Rule]", "None"}]}], "]"}]}], "}"}]}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "autoLegend", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Alignment", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Right", ",", "Top"}], "}"}]}], ",", 
       RowBox[{"Background", "\[Rule]", "White"}], ",", 
       RowBox[{"AspectRatio", "\[Rule]", "Automatic"}]}], "}"}], ",", 
     RowBox[{"FilterRules", "[", 
      RowBox[{
       RowBox[{"Options", "[", "legendMaker", "]"}], ",", 
       RowBox[{"Except", "[", 
        RowBox[{"Alignment", "|", "Background", "|", "AspectRatio"}], "]"}]}],
       "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"autoLegend", "[", 
   RowBox[{"plot_Graphics", ",", "labels_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"lines", ",", "markers", ",", 
      RowBox[{"align", "=", 
       RowBox[{"OptionValue", "[", "Alignment", "]"}]}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lines", ",", "markers"}], "}"}], "=", 
      RowBox[{"extractStyles", "[", "plot", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Graphics", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Inset", "[", 
          RowBox[{"plot", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "1"}], ",", 
             RowBox[{"-", "1"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"Left", ",", "Bottom"}], "}"}], ",", 
           RowBox[{"Scaled", "[", "1", "]"}]}], "]"}], ",", 
         RowBox[{"Inset", "[", 
          RowBox[{
           RowBox[{"legendMaker", "[", 
            RowBox[{"labels", ",", 
             RowBox[{"PlotStyle", "\[Rule]", "lines"}], ",", 
             RowBox[{"PlotMarkers", "\[Rule]", "markers"}], ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"FilterRules", "[", 
               RowBox[{
                RowBox[{"{", "opts", "}"}], ",", 
                RowBox[{"FilterRules", "[", 
                 RowBox[{
                  RowBox[{"Options", "[", "legendMaker", "]"}], ",", 
                  RowBox[{"Except", "[", "Alignment", "]"}]}], "]"}]}], 
               "]"}]}]}], "]"}], ",", "align", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"NumericQ", "[", "#", "]"}], ",", "Center", ",", 
                "#"}], "]"}], "&"}], ",", "align"}], "]"}]}], "]"}]}], "}"}], 
       ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"AspectRatio", "\[Rule]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"OptionValue", "[", "AspectRatio", "]"}], "/.", 
           RowBox[{"Automatic", "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{"AspectRatio", "/.", 
              RowBox[{"Options", "[", 
               RowBox[{"plot", ",", "AspectRatio"}], "]"}]}], ")"}]}]}], "/.", 
          RowBox[{"Automatic", "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{"AspectRatio", "/.", 
             RowBox[{"AbsoluteOptions", "[", 
              RowBox[{"plot", ",", "AspectRatio"}], "]"}]}], ")"}]}]}], 
         ")"}]}]}], "]"}]}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6581249203467655`*^9, 3.6581249783355727`*^9}, {
  3.658125019111621*^9, 3.6581251633382916`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["3D graphics utilities", "Subsection",
 CellChangeTimes->{{3.6581249030337896`*^9, 3.658124906822241*^9}, {
  3.6614970640588236`*^9, 3.6614970697267265`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"dynamicPlot", ",", "HoldAll"}], "]"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "dynamicPlot", "]"}], "=", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Options", "[", "Plot", "]"}], ",", 
      RowBox[{"Options", "[", "Dynamic", "]"}]}], "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicPlot", "[", 
    RowBox[{"f_", ",", 
     RowBox[{"{", 
      RowBox[{"x_Symbol", ",", "x0_", ",", "x1_"}], "}"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bag", "=", 
       RowBox[{"Internal`Bag", "[", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PrintTemporary", "@", 
       RowBox[{"Dynamic", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"Sort", "@", 
            RowBox[{"Internal`BagPart", "[", 
             RowBox[{"bag", ",", "All"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"FilterRules", "[", 
              RowBox[{
               RowBox[{"{", "opts", "}"}], ",", 
               RowBox[{"Options", "[", "ListPlot", "]"}]}], "]"}]}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"FilterRules", "[", 
            RowBox[{
             RowBox[{"{", "opts", "}"}], ",", 
             RowBox[{"Options", "[", "Dynamic", "]"}]}], "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"UpdateInterval", "\[Rule]", "0.5"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Plot", "[", 
       RowBox[{
        RowBox[{"f", "[", "x", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0", ",", "x1"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"EvaluationMonitor", "\[RuleDelayed]", 
         RowBox[{"(", 
          RowBox[{"Internal`StuffBag", "[", 
           RowBox[{"bag", ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"f", "[", "x", "]"}]}], "}"}]}], "]"}], ")"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Evaluate", "[", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"FilterRules", "[", 
           RowBox[{
            RowBox[{"{", "opts", "}"}], ",", 
            RowBox[{"Options", "[", "Plot", "]"}]}], "]"}]}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"dynamicPlot2", ",", "HoldAll"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "dynamicPlot2", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Options", "[", "Plot", "]"}], ",", 
     RowBox[{"Options", "[", "ListPlot", "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"dynamicPlot2", "[", 
   RowBox[{"f_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "x1_"}], "}"}], ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"bag", "=", 
       RowBox[{"Internal`Bag", "[", "]"}]}], ",", 
      RowBox[{"a", "=", "False"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Plot", "[", 
      RowBox[{"f", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0", ",", "x1"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"EvaluationMonitor", "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Internal`StuffBag", "[", 
           RowBox[{"bag", ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "f"}], "}"}]}], "]"}], ";", 
          RowBox[{"a", "=", 
           RowBox[{"!", "a"}]}]}], ")"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opts", "}"}], ",", 
           RowBox[{"Options", "[", "Plot", "]"}]}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], "~", "Monitor", "~", 
     RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"a", ";", 
         RowBox[{"Sort", "@", 
          RowBox[{"Internal`BagPart", "[", 
           RowBox[{"bag", ",", "All"}], "]"}]}]}], ")"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Evaluate", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{"FilterRules", "[", 
          RowBox[{
           RowBox[{"{", "opts", "}"}], ",", 
           RowBox[{"Options", "[", "ListPlot", "]"}]}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.67689560480182*^9, 3.676895707859663*^9}, {
  3.6768959111520405`*^9, 3.6768959123342037`*^9}, {3.6768959700681934`*^9, 
  3.6768960353680882`*^9}, {3.6768961417167754`*^9, 3.676896220456994*^9}, {
  3.676896348070476*^9, 3.6768963761798487`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "barChart3D", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"graphicsOptions", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"colorData", "\[Rule]", "\"\<TemperatureMap\>\""}], ",", 
     RowBox[{"preOptions", "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"barChart3D", "[", 
   RowBox[{"matrix_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Graphics3D", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Evaluate", "[", 
       RowBox[{"OptionValue", "@", "preOptions"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"NumericQ", "[", 
             RowBox[{"matrix", "\[LeftDoubleBracket]", 
              RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "]"}]}], 
           ",", 
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", " ", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"ColorData", "[", 
                RowBox[{"OptionValue", "@", "colorData"}], "]"}], "[", 
               RowBox[{"matrix", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "]"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"Cuboid", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "-", 
                   RowBox[{"1", "/", "2"}]}], ",", 
                  RowBox[{"j", "-", 
                   RowBox[{"1", "/", "2"}]}], ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "+", 
                   RowBox[{"1", "/", "2"}]}], ",", 
                  RowBox[{"j", "+", 
                   RowBox[{"1", "/", "2"}]}], ",", 
                  RowBox[{"matrix", "\[LeftDoubleBracket]", 
                   RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}]}], 
                 "}"}]}], "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "matrix"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"j", ",", 
          RowBox[{"Length", "@", 
           RowBox[{"matrix", "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "All"}], "\[RightDoubleBracket]"}]}]}], 
         "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Evaluate", "[", 
     RowBox[{"OptionValue", "@", "graphicsOptions"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6614970515883026`*^9, 3.661497122461763*^9}, {
  3.665819952112687*^9, 3.6658200463703313`*^9}, {3.6658202631180687`*^9, 
  3.6658202800343513`*^9}, {3.665820371440638*^9, 3.6658204416838837`*^9}, {
  3.665820473362749*^9, 3.665820475311057*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["absSquared", "Subsection",
 CellChangeTimes->{{3.661847060926754*^9, 3.6618470622246857`*^9}}],

Cell["Lets compare Abs2 and absSquared:", "Text",
 CellChangeTimes->{{3.6618429644491234`*^9, 3.661842975686395*^9}, {
  3.661843069259633*^9, 3.6618430696637526`*^9}, {3.661843382538559*^9, 
  3.661843535650234*^9}, {3.6618461796841497`*^9, 3.661846203657056*^9}, {
  3.6618463181246233`*^9, 3.6618463251335087`*^9}, {3.6618472940838594`*^9, 
  3.6618473014622793`*^9}},
 FontWeight->"Bold",
 FontColor->RGBColor[0, 0, 1]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Abs2", "[", "z_", "]"}], " ", ":=", " ", 
   RowBox[{"ComplexExpand", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Abs", "[", "z", "]"}], "^", "2"}], ",", " ", 
     RowBox[{"TargetFunctions", " ", "->", " ", 
      RowBox[{"{", "Conjugate", "}"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"absSquared", ",", 
    RowBox[{"{", 
     RowBox[{"NumericFunction", ",", "Listable"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"absSquared", "[", "z_", "]"}], ":=", 
  RowBox[{"z", " ", 
   RowBox[{"Conjugate", "[", "z", "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.6618470761941013`*^9, 3.6618471200610456`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Do", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Abs2", "[", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], "]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "10000", "}"}]}], "\[IndentingNewLine]", "]"}], "//", 
   "AbsoluteTiming"}], "//", 
  RowBox[{
   RowBox[{
    RowBox[{"First", "@", "#"}], "/", "10000"}], "&"}]}]], "Input",
 CellChangeTimes->{{3.6618471885207396`*^9, 3.661847233027556*^9}}],

Cell[BoxData["0.00015137827528743033`"], "Output",
 CellChangeTimes->{{3.6618472224012856`*^9, 3.661847235135072*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Do", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"absSquared", "[", 
      RowBox[{"RandomReal", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], "]"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "10000", "}"}]}], "\[IndentingNewLine]", "]"}], "//", 
   "AbsoluteTiming"}], "//", 
  RowBox[{
   RowBox[{
    RowBox[{"First", "@", "#"}], "/", "10000"}], "&"}]}]], "Input",
 CellChangeTimes->{{3.6618471885207396`*^9, 3.6618472691464977`*^9}}],

Cell[BoxData["1.7462290223916665`*^-6"], "Output",
 CellChangeTimes->{{3.66184724259449*^9, 3.661847269509554*^9}}]
}, Open  ]],

Cell["\<\
absSquared is faster, while also easily expandable, hence we include it in \
the package\
\>", "Text",
 CellChangeTimes->{{3.6618429644491234`*^9, 3.661842975686395*^9}, {
  3.661843069259633*^9, 3.6618430696637526`*^9}, {3.661843382538559*^9, 
  3.661843535650234*^9}, {3.6618461796841497`*^9, 3.661846203657056*^9}, {
  3.6618463181246233`*^9, 3.6618463251335087`*^9}, {3.66184731301976*^9, 
  3.661847363666745*^9}},
 FontWeight->"Bold",
 FontColor->RGBColor[0, 0, 1]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"absSquared", ",", 
    RowBox[{"{", 
     RowBox[{"NumericFunction", ",", "Listable"}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"absSquared", "[", "z_", "]"}], ":=", 
  RowBox[{"z", " ", 
   RowBox[{"Conjugate", "[", "z", "]"}]}]}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
traceView, source: http://mathematica.stackexchange.com/a/29340/27539\
\>", "Subsection",
 CellChangeTimes->{{3.6618474141790953`*^9, 3.661847415644722*^9}, {
  3.680330221467633*^9, 3.6803302235756493`*^9}}],

Cell[BoxData[{
 RowBox[{"ClearAll", "@", "traceView2"}], "\n", 
 RowBox[{
  RowBox[{"traceView2", "[", "expr_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"steps", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"stack", "=", 
       RowBox[{"{", "}"}]}], ",", "pre", ",", "post", ",", "show", ",", 
      "dynamic"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"pre", "[", "e_", "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"stack", "=", 
         RowBox[{"{", 
          RowBox[{"steps", ",", "stack"}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"steps", "=", 
         RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"post", "[", 
       RowBox[{"e_", ",", "r_"}], "]"}], ":=", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"steps", "=", 
         RowBox[{
          RowBox[{"First", "@", "stack"}], "~", "Join", "~", 
          RowBox[{"{", 
           RowBox[{"show", "[", 
            RowBox[{"e", ",", 
             RowBox[{"HoldForm", "[", "r", "]"}], ",", "steps"}], "]"}], 
           "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"stack", "=", 
         RowBox[{"stack", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], "\[IndentingNewLine]", ")"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"SetAttributes", "[", 
      RowBox[{"post", ",", "HoldAllComplete"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"show", "[", 
       RowBox[{"e_", ",", "r_", ",", "steps_"}], "]"}], ":=", 
      RowBox[{"Grid", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"steps", "/.", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", "}"}], "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{"\"\<Expr  \>\"", ",", "\[IndentingNewLine]", 
               RowBox[{"Row", "[", 
                RowBox[{"{", 
                 RowBox[{"e", ",", "\"\< \>\"", ",", 
                  RowBox[{"Style", "[", 
                   RowBox[{"\"\<inert\>\"", ",", 
                    RowBox[{"{", 
                    RowBox[{"Italic", ",", "Small"}], "}"}]}], "]"}]}], "}"}],
                 "]"}]}], "\[IndentingNewLine]", "}"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"_", "\[Rule]", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<Expr  \>\"", ",", "e"}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"\"\<Steps\>\"", ",", 
                RowBox[{"steps", "/.", 
                 RowBox[{"{", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", "}"}], "\[Rule]", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<no definitions apply\>\"", ",", "Italic"}], 
                    "]"}]}], ",", "\[IndentingNewLine]", 
                   RowBox[{"_", "\[RuleDelayed]", 
                    RowBox[{"OpenerView", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Length", "@", "steps"}], ",", 
                    RowBox[{"dynamic", "@", 
                    RowBox[{"Column", "[", "steps", "]"}]}]}], "}"}], 
                    "]"}]}]}], "\[IndentingNewLine]", "}"}]}]}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"\"\<Result\>\"", ",", "r"}], "}"}]}], 
             "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "}"}]}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"Alignment", "\[Rule]", "Left"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Frame", "\[Rule]", "All"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Background", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", "LightCyan", "}"}], ",", "None"}], "}"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"TraceScan", "[", 
      RowBox[{"pre", ",", "expr", ",", "___", ",", "post"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Deploy", "@", 
      RowBox[{"Pane", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"steps", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "/.", 
         RowBox[{"dynamic", "\[Rule]", "Dynamic"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "10000"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\n", 
 RowBox[{"SetAttributes", "[", 
  RowBox[{"traceView2", ",", 
   RowBox[{"{", "HoldAllComplete", "}"}]}], "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6618474554346566`*^9, 3.6618474554361753`*^9}, {
  3.6618475446892085`*^9, 3.6618477150647893`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["dynamicallyHighlight", "Subsection",
 CellChangeTimes->{{3.6803301894458046`*^9, 3.6803302046021247`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "dynamicallyHighlight", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"objectsToHighlight", "\[Rule]", "_"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SyntaxInformation", "[", "dynamicallyHighlight", "]"}], "=", 
    RowBox[{"{", 
     RowBox[{"\"\<ArgumentsPattern\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"_", ",", "_", ",", 
        RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"DynamicallyHighlight", "[", 
      RowBox[{"tableToPrint_", ",", "equivalenceTest_", ",", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{"DynamicModule", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rul", "=", "Identity"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"EventHandler", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Dynamic", "[", 
            RowBox[{"rul", "@", "#"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\"\<MouseMoved\>\"", "\[RuleDelayed]", 
             RowBox[{"(", 
              RowBox[{"rul", "=", 
               RowBox[{"Function", "[", 
                RowBox[{"y", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"equivalenceTest", "[", 
                    RowBox[{"#", ",", "y"}], "]"}], "||", 
                    RowBox[{"#", "\[Equal]", "y"}]}], ",", 
                   RowBox[{"Style", "[", 
                    RowBox[{"y", ",", "Red", ",", "Bold"}], "]"}], ",", "y"}],
                   "]"}]}], "]"}]}], ")"}]}], "}"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"Cases", "[", 
         RowBox[{"tableToPrint", ",", 
          RowBox[{"OptionValue", "@", "objectsToHighlight"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dynamicallyHighlight", "[", 
    RowBox[{"tableToPrint_", ",", "equivalenceTest_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"DynamicModule", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rul", "=", "Identity"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"tableToPrint", "/.", 
      RowBox[{
       RowBox[{"obj", ":", 
        RowBox[{"OptionValue", "@", "objectsToHighlight"}]}], 
       "\[RuleDelayed]", 
       RowBox[{"EventHandler", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Dynamic", "[", 
          RowBox[{"rul", "@", "obj"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\"\<MouseMoved\>\"", "\[RuleDelayed]", 
           RowBox[{"(", 
            RowBox[{"rul", "=", 
             RowBox[{"Function", "[", 
              RowBox[{"y", ",", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"TrueQ", "[", 
                  RowBox[{
                   RowBox[{"equivalenceTest", "[", 
                    RowBox[{"obj", ",", "y"}], "]"}], "||", 
                   RowBox[{"obj", "\[Equal]", "y"}]}], "]"}], ",", 
                 RowBox[{"Style", "[", 
                  RowBox[{"y", ",", "Red", ",", "Bold"}], "]"}], ",", "y"}], 
                "]"}]}], "\[IndentingNewLine]", "]"}]}], ")"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6803301964341216`*^9, 3.6803302008341227`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["splineCircle", "Subsection",
 CellChangeTimes->{{3.6618474141790953`*^9, 3.661847415644722*^9}, {
  3.665075736001249*^9, 3.6650757374414043`*^9}}],

Cell["Source: http://mathematica.stackexchange.com/a/10958/27539", "Text",
 CellChangeTimes->{{3.6618429644491234`*^9, 3.661842975686395*^9}, {
   3.661843069259633*^9, 3.6618430696637526`*^9}, {3.661843382538559*^9, 
   3.661843535650234*^9}, {3.6618461796841497`*^9, 3.661846203657056*^9}, {
   3.6618463181246233`*^9, 3.6618463251335087`*^9}, {3.66184731301976*^9, 
   3.661847363666745*^9}, {3.6618474242808433`*^9, 3.6618474414575415`*^9}, 
   3.66507576174748*^9},
 FontWeight->"Bold",
 FontColor->RGBColor[0, 0, 1]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "splineCircle", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"splineCircle", "[", 
   RowBox[{"m_List", ",", "r_", ",", 
    RowBox[{"angles_List:", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"2", " ", "\[Pi]"}]}], "}"}]}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "seg", ",", "\[Phi]", ",", "start", ",", "end", ",", "pts", ",", "w", 
       ",", "k"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"start", ",", "end"}], "}"}], "=", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{"angles", "//", "N"}], ",", 
         RowBox[{"2", " ", "\[Pi]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"end", "\[LessEqual]", "start"}], ",", 
        RowBox[{"end", "+=", 
         RowBox[{"2", " ", "\[Pi]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"seg", "=", 
       RowBox[{"Quotient", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"end", "-", "start"}], "//", "N"}], ",", 
         RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Phi]", "=", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"end", "-", "start"}], "//", "N"}], ",", 
         RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"seg", "\[Equal]", "4"}], ",", 
        RowBox[{
         RowBox[{"seg", "=", "3"}], ";", 
         RowBox[{"\[Phi]", "=", 
          RowBox[{"\[Pi]", "/", "2"}]}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pts", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"r", " ", 
          RowBox[{
           RowBox[{"RotationMatrix", "[", "start", "]"}], ".", "#"}]}], "&"}],
         "/@", 
        RowBox[{"Join", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{"-", "1"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"-", "1"}]}], "}"}]}], "}"}], ",", 
            RowBox[{
             RowBox[{"2", " ", "seg"}], "+", "1"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"seg", " ", 
               RowBox[{"\[Pi]", "/", "2"}]}], "]"}], ".", "#"}], "&"}], "/@", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", 
               RowBox[{"Tan", "[", 
                RowBox[{"\[Phi]", "/", "2"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cos", "[", "\[Phi]", "]"}], ",", 
               RowBox[{"Sin", "[", "\[Phi]", "]"}]}], "}"}]}], "}"}]}]}], 
         "\[IndentingNewLine]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "m", "]"}], "\[Equal]", "2"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pts", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"m", "+", "#"}], "&"}], "/@", "pts"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"pts", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"m", "+", "#"}], "&"}], "/@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"Append", "[", 
            RowBox[{
             RowBox[{"Transpose", "@", "pts"}], ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"0", ",", 
               RowBox[{"Length", "@", "pts"}]}], "]"}]}], "]"}]}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"Join", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", 
             RowBox[{"1", "/", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", "1", ",", 
             RowBox[{"1", "/", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", "1", ",", 
             RowBox[{"1", "/", 
              RowBox[{"Sqrt", "[", "2", "]"}]}], ",", "1"}], "}"}], ",", 
           RowBox[{
            RowBox[{"2", " ", "seg"}], "+", "1"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"\[Phi]", "/", "2"}], "]"}], ",", "1"}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"k", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Riffle", "[", 
            RowBox[{"#", ",", "#"}], "]"}], "&"}], "@", 
          RowBox[{"Range", "[", 
           RowBox[{"seg", "+", "1"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"seg", "+", "1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BSplineCurve", "[", 
       RowBox[{"pts", ",", 
        RowBox[{"SplineDegree", "\[Rule]", "2"}], ",", 
        RowBox[{"SplineKnots", "\[Rule]", "k"}], ",", 
        RowBox[{"SplineWeights", "\[Rule]", "w"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}], "/;", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "m", "]"}], "\[Equal]", "2"}], "||", 
    RowBox[{
     RowBox[{"Length", "[", "m", "]"}], "\[Equal]", "3"}]}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6650755163580213`*^9, 3.665075605315544*^9}, {
  3.6650756714955373`*^9, 3.665075703774338*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["EndPackage", "Section",
 CellChangeTimes->{{3.6581248684950485`*^9, 3.658124870497815*^9}}],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1829, 946},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
Magnification:>1.6 Inherited,
FrontEndVersion->"10.4 for Microsoft Windows (64-bit) (February 25, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 96, 1, 112, "Section"],
Cell[679, 25, 153, 3, 47, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[869, 33, 93, 1, 112, "Section"],
Cell[965, 36, 610, 17, 52, "Text"],
Cell[1578, 55, 2836, 59, 657, "Input",
 InitializationCell->True],
Cell[4417, 116, 408, 7, 48, "Text"],
Cell[4828, 125, 1474, 30, 280, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[6327, 159, 114, 1, 77, "Subsection"],
Cell[6444, 162, 475, 9, 135, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[6956, 176, 111, 1, 77, "Subsection"],
Cell[7070, 179, 339, 8, 106, "Input"],
Cell[7412, 189, 705, 14, 48, "Text"],
Cell[8120, 205, 410, 8, 106, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[8579, 219, 104, 1, 112, "Section"],
Cell[8686, 222, 101, 2, 47, "Input",
 InitializationCell->True],
Cell[8790, 226, 664, 18, 47, "Input",
 InitializationCell->True],
Cell[9457, 246, 3842, 90, 483, "Input",
 InitializationCell->True],
Cell[13302, 338, 413, 12, 47, "Input",
 InitializationCell->True],
Cell[13718, 352, 2085, 47, 193, "Input",
 InitializationCell->True],
Cell[15806, 401, 878, 20, 193, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[16709, 425, 109, 1, 77, "Subsection"],
Cell[16821, 428, 3952, 99, 12003, "Input",
 InitializationCell->True],
Cell[20776, 529, 22313, 548, 39062, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[43126, 1082, 164, 2, 61, "Subsection"],
Cell[43293, 1086, 5437, 141, 918, "Input",
 InitializationCell->True],
Cell[48733, 1229, 3397, 79, 599, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[52167, 1313, 100, 1, 77, "Subsection"],
Cell[52270, 1316, 423, 7, 928, "Text"],
Cell[52696, 1325, 745, 21, 2206, "Input"],
Cell[CellGroupData[{
Cell[53466, 1350, 526, 15, 2828, "Input"],
Cell[53995, 1367, 118, 1, 948, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[54150, 1373, 534, 15, 2828, "Input"],
Cell[54687, 1390, 115, 1, 948, "Output"]
}, Open  ]],
Cell[54817, 1394, 481, 10, 928, "Text"],
Cell[55301, 1406, 370, 11, 1596, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[55708, 1422, 218, 4, 61, "Subsection"],
Cell[55929, 1428, 5010, 120, 1034, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[60976, 1553, 112, 1, 77, "Subsection"],
Cell[61091, 1556, 3654, 89, 483, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64782, 1650, 153, 2, 77, "Subsection"],
Cell[64938, 1654, 522, 8, 121, "Text"],
Cell[65463, 1664, 6377, 172, 1681, "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[71889, 1842, 97, 1, 112, "Section"],
Cell[71989, 1845, 139, 3, 77, "Input",
 InitializationCell->True]
}, Open  ]]
}
]
*)

